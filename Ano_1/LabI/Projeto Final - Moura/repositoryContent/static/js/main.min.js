function generateContent(){var e=window.location.href.toLowerCase();if("index"==$("div.content").data("id"))$("#logo img").prop("src",path+"/static/img/100brains.png"),$.get(path+"/userID",function(e){sessionStorage.setItem("userID",e.userID),sessionStorage.setItem("username",e.username),sessionStorage.setItem("avatar",e.avatar),sessionStorage.setItem("userUpvotes",e.upvotes),sessionStorage.setItem("userDownvotes",e.downvotes),sessionStorage.setItem("userViews",e.views)}),setTimeout(function(){location.replace(path+"/static/home.html")},600);else if("upload"==$("div.content").data("id")){i=(o=parseURLParams(e)).id[0];$("#effect").parent().attr("href","effectify.html?id="+i),$("#meme").parent().parent().attr("href","memefy.html?id="+i),$("#currentImage").parent().click(function(){$("#loading").toggleClass("invisible"),$.post(path+"/api/putAdvanced",{id:i,type:"PHOTO",allIDs:"["+i+"]"},function(){location.replace("gallery.html?g=photo&sort=upvotes")},"json")});var t=i.split("."),a=path+"/api/getTemp?id="+i,s=path+"/api/getTemp?id="+t[0]+"-neg."+t[1];setImgSrc(a,"#currentImage",!1),setImgSrc(s,"#effect",!1),setImgSrc(a,"#meme",!1)}else if("image"==$("div.content").data("id")){var i=(o=parseURLParams(e)).id[0];setImgSrc(path+"/api/get?id="+i,"#mainImg",!1);var n=document.referrer;-1===n.indexOf("gallery.")&&-1===n.indexOf("all.")&&(n="gallery.html?g=photo&sort=upvotes"),$("#header a").attr("href",n),getImgInfo(i,function(e){$("#views span").html(e.views),$(".votes span.upvotes").html(e.votes_up),$(".votes span.downvotes").html(e.votes_down);var t=JSON.parse(sessionStorage.getItem("userViews"));-1===t[e.category].indexOf(i)&&$.post(path+"/api/updateViews",{imgID:i},function(){t[e.category].push(i),sessionStorage.setItem("userViews",JSON.stringify(t))},"json")})}else if("effectify"==$("div.content").data("id")){var o=parseURLParams(e),t=(i=o.id[0]).split(".");setImgSrc(path+"/api/getTemp?id="+i,"#mainImg",!1),$("#header a").attr("href","upload.html?id="+i);var r=[i],p=0;$.get(path+"/api/getEffectThumbnails",{tempID:t[0],imgExtension:t[1]},function(e){for(var t=0;t<e.length;t++){var a=JSON.parse(e[t]);$('button[name="'+a.effect+'"] img').prop("src","data:image/"+a.id.split(".")[1]+";base64,"+a.image)}},"json"),$("#effectsList button").click(function(){var e=$(this).attr("name");i.split(".");$("#loading").toggleClass("invisible");var t=r[p].split(".");$.post(path+"/api/getEffectPreview",{tempImgID:t[0],imgExtension:t[1],effect:e},function(e){e=JSON.parse(e),r.push(e.newImgID),p++,setImgSrc(path+"/api/getTemp?id="+e.newImgID,"#mainImg",!1),$("#loading").toggleClass("invisible")},"json")}),$("button#undo").click(function(){p--,r.pop(),setImgSrc(path+"/api/getTemp?id="+r[p],"#mainImg",!1)}),$('button[type="submit"]').click(function(){$("#loading").toggleClass("invisible");var e=0===p?"PHOTO":"EFFECT";$.post(path+"/api/putAdvanced",{id:r[p],type:e,allIDs:JSON.stringify(r)},function(){location.replace("gallery.html?g="+e.toLowerCase()+"&sort=upvotes")},"json")})}else if("memefy"==$("div.content").data("id")){var o=parseURLParams(e),r=[i=o.id[0]],p=0;setImgSrc(path+"/api/getTemp?id="+i,"#mainImg",!1),$("#header a").attr("href","upload.html?id="+i),$('#memefy button[name="preview"]').click(function(e){e.preventDefault();var t=$('#memefy input[name="topLine"]').val(),a=$('#memefy input[name="bottomLine"]').val();if(""!=t||""!=a){$("#loading").toggleClass("invisible");var s=r[p].split(".");$.post(path+"/api/getMemePreview",{tempImgID:s[0],imgExtension:s[1],topLine:t,bottomLine:a},function(e){e=JSON.parse(e),r.push(e.newImgID),p++,setImgSrc(path+"/api/getTemp?id="+e.newImgID,"#mainImg",!1),$("#loading").toggleClass("invisible")},"json")}}),$('#memefy button[type="submit"]').click(function(e){e.preventDefault();var t=$('#memefy input[name="topLine"]').val(),a=$('#memefy input[name="bottomLine"]').val(),s=""==t&&""==a?"PHOTO":"MEME";$.post(path+"/api/putAdvanced",{id:r[p],type:s,allIDs:JSON.stringify(r)},function(){location.replace("gallery.html?g="+s.toLowerCase()+"&sort=upvotes")},"json")})}else if("gallery"==$("div.content").data("id")){-1===e.indexOf("photo&")&&-1===e.indexOf("effect&")&&-1===e.indexOf("meme&")&&window.location.replace("gallery.html?g=photo&sort=upvotes");var l=(o=parseURLParams(e)).g[0].toUpperCase();$("h3").html(l.charAt(0)+l.slice(1).toLowerCase());var g=o.sort[0];$("#sort li").removeClass("selected"),$('[data-sort="'+g+'"]').addClass("selected");for(var m=$("#sort li a"),d=0;d<m.length;d++)$(m[d]).attr("href","gallery.html?g="+l+"&sort="+$($("#sort li")[d]).data("sort"));$.get(path+"/api/list",function(e){var t=JSON.parse(sessionStorage.getItem("userUpvotes"))[l],a=JSON.parse(sessionStorage.getItem("userDownvotes"))[l];(e=JSON.parse(e)).sort(imgSort(g));for(var s=0;s<e.length;s++)addNewImage(e[s],t,a)})}else"all"==$("div.content").data("id")?($("#loading").toggleClass("invisible"),$.get(path+"/api/listAll",function(e){$("#loading").toggleClass("invisible"),e=JSON.parse(e);for(var t=0;t<e.length;t++)for(key in e[t]){$(".content").append("<ul class='table-view gallery-view' id='"+key+"'>                                   <h4>"+(2==key?"100Cerebros'":"Group "+key+"'s")+" Images</h4>                                 </ul>");for(var a=0;a<e[t][key].length;a++)addNewImageOnly(e[t][key][a],"https://xcoa.av.it.pt/labi1617-p2-g"+key+"/api/get?id="+e[t][key][a].id,"#"+key,"not-selected","","not-selected","")}})):"settings"==$("div.content").data("id")?($("#username").html(sessionStorage.getItem("username")),$("#userAvatar").prop("src","img/icons/avatar_"+sessionStorage.getItem("avatar")+".png"),$("#changeUsername button[type=submit]").click(function(e){e.preventDefault();var t=$('#changeUsername input[name="username"]').val();$.post(path+"/api/updateUserInfo",{avatar:sessionStorage.getItem("avatar"),username:t},function(){sessionStorage.setItem("username",t),location.reload()},"json")}),$("#avatarModal img").click(function(e){var t=$(e.target).data("index");$.post(path+"/api/updateUserInfo",{avatar:t,username:sessionStorage.getItem("username")},function(){sessionStorage.setItem("avatar",t),location.reload()},"json")})):"logout"==$("div.content").data("id")&&(sessionStorage.clear(),$("#login").attr("href",path))}function parseURLParams(e){var t,a,s,i,n=e.indexOf("?")+1,o=e.indexOf("#")+1||e.length+1,r=e.slice(n,o-1),p=r.replace(/\+/g," ").split("&"),l={};if(r!==e&&""!==r){for(t=0;t<p.length;t++)i=p[t].split("=",2),a=decodeURIComponent(i[0]),s=decodeURIComponent(i[1]),l.hasOwnProperty(a)||(l[a]=[]),l[a].push(2===i.length?s:null);return l}}function addNewImage(e,t,a){var s="not-selected",i="not-selected",n="",o="";-1!==t.indexOf(e.id)?(s="selected",n="_small"):-1!==a.indexOf(e.id)&&(i="selected",o="_small"),addNewImageOnly(e,path+"/api/get?id="+e.id,"#imgList",s,n,i,o)}function addNewImageOnly(e,t,a,s,i,n,o){$(a).append("<li class='table-view-cell media' >         <a href= 'image.html?id="+e.id+"'>           <img id='"+e.id+"' class='media-object pull-left' src=''>           <div class='votes'>             <img src='img/icons/upvotes"+i+".png' alt='Upvote'>             <span class='upvotes "+s+"'>"+e.votes_up+"</span>             <img src='img/icons/downvotes"+o+".png' alt='Downvote'>             <span class='downvotes "+n+"'>"+e.votes_down+"</span>           </div>         </a>       </li>"),setImgSrc(t,"#"+e.id,!0)}function setImgSrc(e,t,a){var s=new XMLHttpRequest;s.onreadystatechange=function(e){if(4==this.readyState&&200==this.status){var s=new FileReader;s.onload=function(){$(t).prop("src",s.result),a&&$(t).removeAttr("id")},s.readAsDataURL(this.response)}},s.open("GET",e),s.responseType="blob",s.send()}function getImgInfo(e,t){$.get(path+"/api/getImgInfo",{id:e},function(e){t(e)},"json")}function imgSort(e){return"votes"===e?function(e,t){return t.votes_up+t.votes_down-e.votes_up-e.votes_down}:"views"===e?function(e,t){return t.views-e.views}:"date"===e?function(e,t){return e.date-t.date}:function(e,t){return t.votes_up-e.votes_up}}function updateVotes(e,t,a){var s=$(e).html();a?s--:s++,$(e).html(s),$(t).toggleClass("inactive")}path="https://xcoa.av.it.pt/labi1617-p2-g2",window.addEventListener("push",function(){generateContent()}),$(document).ready(function(){generateContent()}),$(document).on("change","#getMedia",function(){$("#loading").toggleClass("invisible");var e=$("#getMedia input")[0].files;if(e&&e[0]){var t=e[0];fileRead=new FileReader,fileRead.onload=function(){var e=fileRead.result.split(",");$.ajax({url:path+"/api/getNegative",type:"POST",data:JSON.stringify({imgExtension:e[0].split(";")[0].split("/")[1],img:e[1]}),headers:{"Content-Type":"application/json"},dataType:"json",success:function(e){location.href="upload.html?id="+JSON.parse(e).tempImgID}})},fileRead.readAsDataURL(t)}}),$(document).on("click","#toggleSort",function(){$("#sort").toggleClass("invisible")}),$(document).on("click","#imageView .votes button.upvote",function(){var e="#imageView .votes button.upvote",t=$(e).hasClass("inactive"),a=$("#mainImg").data("id");$("#imageView .votes button.downvote").hasClass("inactive")||$.post(path+"/api/updateVotes",{imgID:a,vote:t?2:1},function(){getImgInfo(a,function(s){var i=JSON.parse(sessionStorage.getItem("userUpvotes"));t?i[category].push(a):i[category].splice(i[s.category].indexOf(a),1),sessionStorage.setItem("userViews",JSON.stringify(i)),updateVotes("#imageView .votes button.upvote span.upvotes",e,t)})},"json")}),$(document).on("click","#imageView .votes button.downvote",function(){var e="#imageView .votes button.upvote",t=$("#imageView .votes button.downvote").hasClass("inactive"),a=$("#mainImg").data("id");$(e).hasClass("inactive")||$.post(path+"/api/updateVotes",{imgID:a,vote:t?-1:0},function(){getImgInfo(a,function(s){JSON.parse(sessionStorage.getItem("userDownvotes"));t?userUpvotes[s.category].push(a):userUpvotes[s.category].splice(userUpvotes[s.category].indexOf(a),1),sessionStorage.setItem("userViews",JSON.stringify(userUpvotes)),updateVotes(upvoteNum,e,t)})},"json")});